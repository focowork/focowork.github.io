<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>FocoWork</title>

  <!-- PWA -->
<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="/icons/icon-180.png">
<link rel="stylesheet" href="/styles.css">

<script src="/app.js"></script>

<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("/sw-v2.js");
    });
  }
</script>


  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/focoworklimited/icons/icon-180.png">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="app">

    <!-- HEADER -->
    <header class="header">
      <div id="clientName" class="client-name">Sin cliente activo</div>
      <div id="activityName" class="activity-name">â€”</div>
      <div id="timer" class="timer">00:00:00</div>
      <div id="clientTotal" class="client-total"></div>
      
      <!-- TIEMPO FACTURABLE -->
      <div id="billableTimeBox" class="billable-time-box" style="display: none;"></div>
      
      <!-- AVISO FUERA DE HORARIO DE ENFOQUE -->
      <div id="focusScheduleStatus" style="display: none; margin-top: 8px; padding: 6px 12px; background: rgba(251, 191, 36, 0.2); border-radius: 6px; font-size: 0.85rem; color: #fbbf24; text-align: center;"></div>
    </header>

    <!-- ACTIVIDADES -->
    <section class="panel">
      <div class="grid activities">
        <button class="activity" data-activity="work">ğŸŸ¦ Trabajo</button>
        <button class="activity" data-activity="phone">ğŸ“ TelÃ©fono</button>
        <button class="activity" data-activity="client">ğŸ‘¥ Cliente</button>
        <button class="activity" data-activity="visit">ğŸ“˜ Visitando</button>
        <button class="activity full-width" data-activity="other">âš™ï¸ Otros</button>
      </div>
    </section>

    <!-- INFO CLIENTE (CÃMARA + NOTAS) -->
    <section class="panel" id="clientInfoPanel">
      
      <!-- FECHA DE ENTREGA -->
      <div id="deliveryDateBox" class="delivery-info hidden"></div>

      
      <!-- WORKPAD (Bloc de notas) -->
      <div class="workpad-container">
        <div class="workpad-header">
          <span class="workpad-icon">ğŸ“</span>
          <span class="workpad-title">Notas del cliente</span>
        </div>
        <textarea 
          id="clientWorkpad" 
          class="workpad-area" 
          placeholder="Apuntes, tareas pendientes, detalles del proyecto..."
          style="display: none;"
        ></textarea>
      </div>

      <!-- FEINES PER URGÃˆNCIA -->
      <div class="workpad-container">
        <div class="workpad-header">
          <span class="workpad-icon">ğŸš¨</span>
          <span class="workpad-title">Feines per urgÃ¨ncia</span>
        </div>

        <textarea
          id="taskUrgent"
          class="workpad-area urgent"
          placeholder="ğŸ”´ Urgent (avui, foc, bloquejant...)"
        ></textarea>

        <textarea
          id="taskImportant"
          class="workpad-area important"
          placeholder="ğŸŸ  Important (segÃ¼ent pas)"
        ></textarea>

        <textarea
          id="taskLater"
          class="workpad-area later"
          placeholder="ğŸŸ¢ Quan es pugui (no oblidar)"
        ></textarea>
      </div>

      <div class="grid" style="margin-top: 12px;">
        <button id="setDeliveryDateBtn" class="primary">
          ğŸ“… Fecha
        </button>
        <button id="generateReportBtn" class="primary">
          ğŸ“‹ Informe
        </button>
      </div>

      <div class="grid" style="margin-top: 12px;">
        <button id="addExtraHoursBtn" class="secondary">
          â±ï¸ AÃ±adir horas
        </button>
        <button id="viewExtraHoursBtn" class="secondary">
          ğŸ“Š Ver horas
        </button>
      </div>

      <button id="cameraBtn" class="primary">
        ğŸ“· AÃ±adir foto al cliente
      </button>

      <!-- GalerÃ­a (se llenarÃ¡ por JS) -->
      <div id="photoGallery" class="photo-gallery"></div>
    </section>

    <!-- CLIENTES -->
    <section class="panel">
      <div class="grid actions">
        <button id="newClient">â• Nuevo</button>
        <button id="changeClient">ğŸ”„ Cambiar</button>
        <button id="historyBtn">ğŸ“‚ HistÃ³rico</button>
        <button id="closeClient" class="danger">âœ… Cerrar</button>
      </div>
    </section>

    <!-- BACKUP Y GESTIÃ“N -->
    <section class="panel">
      <div class="grid">
        <button id="exportWorkBtn">ğŸ’¾ Guardar trabajo</button>
        <button id="importWorkBtn">ğŸ“‚ Cargar trabajo</button>
        <button id="exportAllBtn" class="full-width">ğŸ“¦ Backup completo</button>
        <button id="exportToDriveBtn" class="full-width">â˜ï¸ Exportar a Drive</button>
        <button id="backupConfigBtn" class="full-width">âš™ï¸ Config. Backups</button>
      </div>
      <p style="font-size: 12px; opacity: 0.6; text-align: center; margin-top: 8px;">
        ğŸ’¡ El botÃ³n "Cargar trabajo" acepta tanto trabajos individuales como backups completos
      </p>
    </section>

    <!-- BORRAR CLIENTE (solo visible para clientes cerrados) -->
    <section class="panel">
      <button id="deleteClientBtn" class="danger" style="display: none;">
        ğŸ—‘ï¸ Borrar este cliente
      </button>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
      <button id="focusBtn">ğŸ¯ Enfoque</button>
      <button id="scheduleBtn">â° Horario</button>
      <button id="todayBtn">ğŸ“„ CSV</button>
    </footer>

    <!-- VERSIÃ“N / ACTIVACIÃ“N -->
    <div id="versionBox" class="version-box">
      <div class="lock">
        ğŸ”’ <strong>VersiÃ³n de prueba</strong><br />
        MÃ¡ximo 2 clientes activos simultÃ¡neamente
      </div>

      <button id="loadLicenseBtn" class="primary">
        ğŸ“„ Cargar archivo de licencia
      </button>

      <button id="requestLicenseBtn">
        ğŸ’¬ Solicitar licencia por WhatsApp
      </button>
      
      <div id="licenseInfo" style="display: none; margin-top: 12px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; font-size: 13px; text-align: center; color: #10b981;"></div>
    </div>

  </div>

  <!-- ===============================================
       MODALES
       =============================================== -->

  <!-- MODAL: Nuevo Cliente -->
  <div id="modalNewClient" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">â•</span>
        <h2 class="modal-title">Nuevo cliente</h2>
      </div>
      <div class="modal-body">
        <label class="modal-label">Cliente + descripciÃ³n del trabajo</label>
        <input type="text" id="inputNewClient" class="modal-input" placeholder="Ej: Juan - DiseÃ±o web corporativo">
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalNewClient')">Cancelar</button>
        <button class="btn-primary" onclick="confirmNewClient()">Crear</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Fecha de Entrega -->
  <div id="modalDeliveryDate" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“…</span>
        <h2 class="modal-title">Fecha de Entrega</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text">Establece la fecha de entrega del proyecto:</p>
        <input type="date" id="inputDeliveryDate" class="modal-input">
        <p class="modal-text" style="font-size: 0.85rem; opacity: 0.7; margin-top: 12px;">
          ğŸ’¡ Deja vacÃ­o para eliminar la fecha de entrega
        </p>
        <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid #3b82f6;">
          <p style="margin: 0; font-size: 0.9rem; color: #93c5fd;">
            â„¹ï¸ La fecha aparecerÃ¡ en el Ã¡rea de tareas urgentes y en el listado de clientes
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalDeliveryDate')">Cancelar</button>
        <button class="btn-primary" onclick="saveDeliveryDate()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: AÃ±adir Horas Extra -->
  <div id="modalExtraHours" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">â±ï¸</span>
        <h2 class="modal-title">AÃ±adir Horas Extra</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text">Registra horas trabajadas fuera del proyecto principal:</p>
        
        <label class="modal-label">Horas</label>
        <input type="number" id="inputExtraHours" class="modal-input" placeholder="Ej: 2.5" step="0.25" min="0.25">
        
        <label class="modal-label">DescripciÃ³n</label>
        <input type="text" id="inputExtraDescription" class="modal-input" placeholder="Ej: ReuniÃ³n cliente, DiseÃ±o adicional, etc.">
        
        <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid #3b82f6;">
          <p style="margin: 0; font-size: 0.9rem; color: #93c5fd;">
            â„¹ï¸ Estas horas se sumarÃ¡n al tiempo facturable del cliente
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalExtraHours')">Cancelar</button>
        <button class="btn-primary" onclick="saveExtraHours()">AÃ±adir</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Ver Horas Extra -->
  <div id="modalViewExtraHours" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“Š</span>
        <h2 class="modal-title">Horas Extra Registradas</h2>
      </div>
      <div class="modal-body">
        <div id="extraHoursList" class="extra-hours-list"></div>
        <div class="total-stats" style="margin-top: 16px;">
          <div class="total-time">
            Total horas extra: <strong id="extraHoursTotal">00:00:00</strong>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-primary" onclick="closeModal('modalViewExtraHours')">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Informe/Report -->
  <div id="modalReport" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“‹</span>
        <h2 class="modal-title">Informe de Proyecto</h2>
      </div>
      <div class="modal-body">
        <pre id="reportContent" class="report-content"></pre>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalReport')">Cerrar</button>
        <button class="btn-primary" onclick="copyReport()">ğŸ“‹ Copiar</button>
        <button class="btn-success" onclick="shareReport()">ğŸ“¤ Compartir</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Cambiar Cliente -->
  <div id="modalChangeClient" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ”„</span>
        <h2 class="modal-title">Cambiar cliente</h2>
      </div>
      <div class="modal-body">
        <div id="activeClientsList" class="clients-list"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalChangeClient')">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: HistÃ³rico -->
  <div id="modalHistory" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“‚</span>
        <h2 class="modal-title">HistÃ³rico de clientes</h2>
      </div>
      <div class="modal-body">
        <input type="text" id="searchHistory" class="modal-input" placeholder="ğŸ” Buscar cliente o trabajo...">
        <div id="historyClientsList" class="clients-list"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalHistory')">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Confirmar Cerrar Cliente -->
  <div id="modalCloseClient" class="modal-overlay hidden">
    <div class="modal modal-confirm">
      <div class="modal-header">
        <span class="modal-icon">âœ…</span>
        <h2 class="modal-title">Cerrar cliente</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="closeClientText"></p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalCloseClient')">Cancelar</button>
        <button class="btn-success" onclick="confirmCloseClient()">Cerrar cliente</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Exportar antes de cerrar -->
  <div id="modalExportBeforeClose" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ’¾</span>
        <h2 class="modal-title">Guardar antes de cerrar</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="exportBeforeCloseText"></p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="confirmCloseClient()">No, cerrar sin guardar</button>
        <button class="btn-primary" onclick="exportAndClose()">SÃ­, guardar y cerrar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Importar Trabajo -->
  <div id="modalImportWork" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“‚</span>
        <h2 class="modal-title">Importar trabajo</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text">Â¿Deseas importar este trabajo?</p>
        <div style="background: rgba(51, 65, 85, 0.4); padding: 16px; border-radius: 12px; margin: 12px 0;">
          <p style="margin: 8px 0;"><strong>Cliente:</strong> <span id="importClientName"></span></p>
          <p style="margin: 8px 0;"><strong>Tiempo total:</strong> <span id="importClientTime"></span></p>
          <p style="margin: 8px 0;"><strong>Fotos:</strong> <span id="importClientPhotos"></span></p>
          <p style="margin: 8px 0;"><strong>Notas:</strong> <span id="importClientNotes"></span></p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalImportWork')">Cancelar</button>
        <button class="btn-primary" onclick="confirmImport()">Importar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Importar Backup Completo -->
  <div id="modalImportBackup" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“¦</span>
        <h2 class="modal-title">Restaurar backup completo</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" style="color: #fbbf24;">âš ï¸ ATENCIÃ“N: Esto restaurarÃ¡ TODOS tus datos desde el backup.</p>
        <div style="background: rgba(51, 65, 85, 0.4); padding: 16px; border-radius: 12px; margin: 12px 0;">
          <p style="margin: 8px 0;"><strong>Total clientes:</strong> <span id="importBackupClients"></span></p>
          <p style="margin: 8px 0;"><strong>Clientes activos:</strong> <span id="importBackupActive"></span></p>
          <p style="margin: 8px 0;"><strong>Fecha backup:</strong> <span id="importBackupDate"></span></p>
          <p style="margin: 8px 0;"><strong>Licencia incluida:</strong> <span id="importBackupLicense"></span></p>
        </div>
        <p class="modal-text" style="font-size: 13px; opacity: 0.8;">La pÃ¡gina se recargarÃ¡ automÃ¡ticamente despuÃ©s de restaurar.</p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalImportBackup')">Cancelar</button>
        <button class="btn-success" onclick="confirmImportBackup()">Restaurar backup</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Confirmar Borrar Cliente -->
  <div id="modalDeleteClient" class="modal-overlay hidden">
    <div class="modal modal-confirm">
      <div class="modal-header">
        <span class="modal-icon">ğŸ—‘ï¸</span>
        <h2 class="modal-title">Eliminar cliente</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="deleteClientText"></p>
        <label class="modal-label">Escribe BORRAR para confirmar</label>
        <input type="text" id="inputDeleteConfirm" class="modal-input" placeholder="BORRAR">
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalDeleteClient')">Cancelar</button>
        <button class="btn-danger" onclick="confirmDeleteClient()">Eliminar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Enfoque Diario -->
  <div id="modalEnfoque" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ¯</span>
        <div>
          <h2 class="modal-title">Enfoque diario</h2>
          <p class="modal-subtitle" id="modalUserName"></p>
        </div>
      </div>
      <div class="modal-body">
        <div class="activity-list" id="modalActivityList"></div>
        <div class="total-stats">
          <div class="total-time">
            Total trabajado: <strong id="modalTotalTime"></strong>
          </div>
        </div>
        <div id="modalFocusState" class="focus-state"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-primary" onclick="closeModal('modalEnfoque')">Aceptar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Configurar Horario de Enfoque -->
  <div id="modalSchedule" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">â°</span>
        <h2 class="modal-title">Horario de enfoque</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" style="opacity: 0.8; margin-bottom: 20px;">
          El enfoque solo contabiliza tiempo dentro del horario configurado. Fuera de ese horario puedes seguir trabajando, pero no afecta a las mÃ©tricas de enfoque.
        </p>

        <label class="modal-label" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; cursor: pointer;">
          <input type="checkbox" id="scheduleEnabled" style="width: 20px; height: 20px; cursor: pointer;">
          <span>Activar horario de enfoque</span>
        </label>

        <div id="scheduleConfig" style="display: none;">
          <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
            <div style="flex: 1;">
              <label class="modal-label">Hora inicio</label>
              <input type="time" id="scheduleStart" class="modal-input" value="09:00">
            </div>
            <div style="flex: 1;">
              <label class="modal-label">Hora fin</label>
              <input type="time" id="scheduleEnd" class="modal-input" value="17:00">
            </div>
          </div>

          <div class="schedule-presets">
            <p class="modal-label" style="margin-bottom: 10px;">Presets rÃ¡pidos:</p>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
              <button class="btn-secondary" onclick="applyPreset('07:00', '14:00')">ğŸŒ… MaÃ±ana<br><small>07:00 - 14:00</small></button>
              <button class="btn-secondary" onclick="applyPreset('15:00', '22:00')">ğŸŒ† Tarde<br><small>15:00 - 22:00</small></button>
              <button class="btn-secondary" onclick="applyPreset('09:00', '17:00')">ğŸ¢ Oficina<br><small>09:00 - 17:00</small></button>
              <button class="btn-secondary" onclick="applyPreset('09:00', '18:00')">ğŸ’¼ Completo<br><small>09:00 - 18:00</small></button>
            </div>
          </div>

          <div style="margin-top: 20px; padding: 12px; background: rgba(0, 255, 136, 0.1); border-radius: 8px; border-left: 3px solid #00ff88;">
            <p style="margin: 0; font-size: 13px; color: #00ff88;">
              <strong id="schedulePreview">09:00 - 17:00</strong>
            </p>
            <p style="margin: 5px 0 0; font-size: 12px; opacity: 0.7;">
              DuraciÃ³n: <span id="scheduleDuration">8h 0m</span>
            </p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalSchedule')">Cancelar</button>
        <button class="btn-primary" onclick="saveScheduleConfig()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: ConfiguraciÃ³n de Backups AutomÃ¡ticos -->
  <div id="modalBackupConfig" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">âš™ï¸</span>
        <h2 class="modal-title">ConfiguraciÃ³n de Backups</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" style="opacity: 0.8; margin-bottom: 20px;">
          Configura los backups automÃ¡ticos a Google Drive. Se realizarÃ¡n cada medianoche.
        </p>

        <label class="modal-label" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; cursor: pointer;">
          <input type="checkbox" id="autoDriveBackupCheckbox" style="width: 20px; height: 20px; cursor: pointer;">
          <span>Activar backups automÃ¡ticos en Drive</span>
        </label>

        <div style="padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid #3b82f6;">
          <p style="margin: 0; font-size: 0.9rem; color: #93c5fd;">
            â„¹ï¸ Los backups se guardarÃ¡n automÃ¡ticamente en tu Google Drive cada dÃ­a a medianoche
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalBackupConfig')">Cancelar</button>
        <button class="btn-primary" onclick="saveBackupConfig()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Eliminar Foto -->
  <div id="modalDeletePhoto" class="modal-overlay hidden">
    <div class="modal modal-confirm">
      <div class="modal-header">
        <span class="modal-icon">ğŸ—‘ï¸</span>
        <h2 class="modal-title">Eliminar foto</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text">Â¿Eliminar esta foto del cliente?</p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalDeletePhoto')">Cancelar</button>
        <button class="btn-danger" onclick="confirmDeletePhoto()">Eliminar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Avisos (reemplaza alert genÃ©rico) -->
  <div id="modalAlert" class="modal-overlay hidden">
    <div class="modal modal-alert">
      <div class="modal-header">
        <span class="modal-icon" id="alertIcon">â„¹ï¸</span>
        <h2 class="modal-title" id="alertTitle">Aviso</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="alertText"></p>
      </div>
      <div class="modal-footer">
        <button class="btn-primary" onclick="closeModal('modalAlert')">Aceptar</button>
      </div>
    </div>
  </div>

            
  <script src="app.js"></script>

</body>
</html>
